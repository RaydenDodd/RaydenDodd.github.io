<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>

<header class="nav">
  <div class="nav-left">
    <a class="brand" href="../index.html">Rayden Dodd</a>
  </div>
  <nav class="nav-right">
    <a class="active" href="./index.html">Projects</a>
    <a href="../games.html">Games</a>
    <a href="../index.html#contact">Contact</a>
  </nav>
</header>

<main class="page">

  <a class="muted" href="./index.html" style="display:inline-block;margin-bottom:18px;">
    ← Back to Projects
  </a>

  <section class="teaser">
    <div class="teaser-inner" style="--panel-bg:none;">
      <h1 id="title" style="margin:0 0 6px;"></h1>
      <p id="desc" class="muted" style="margin:0 0 14px;"></p>
      <div id="tags" class="tag-row"></div>
      <div id="links" class="card-actions" style="margin-top:14px;"></div>
    </div>
  </section>

  <div id="sections"></div>

</main>

<footer class="footer">
  <span>© <span id="year"></span> Rayden Dodd</span>
</footer>

<script src="./projects.js"></script>
<script>
document.getElementById("year").textContent = new Date().getFullYear()

const qs = new URLSearchParams(location.search)
const id = qs.get("id")
const proj = (window.PROJECTS || []).find(p => p.id === id)

const viewer = "https://cdn.jsdelivr.net/npm/pdfjs-dist@5.4.530/web/viewer.html"

const titleEl = document.getElementById("title")
const descEl = document.getElementById("desc")
const tagsEl = document.getElementById("tags")
const linksEl = document.getElementById("links")
const sectionsEl = document.getElementById("sections")

const btn = (label, href) =>
  `<a class="btn small" href="${href}" target="_blank" rel="noopener noreferrer">${label}</a>`

if (!proj) {
  titleEl.textContent = "Project not found"
  descEl.textContent = "Missing or invalid project id in the URL."
  sectionsEl.innerHTML = ""
} else {
  document.title = proj.title
  titleEl.textContent = proj.title
  descEl.textContent = proj.desc || ""

  tagsEl.innerHTML = (proj.tags || []).map(t => `<span class="tag">${t}</span>`).join("")

  linksEl.innerHTML = [
    proj.repo ? btn("Repo", proj.repo) : "",
    proj.live ? btn("Live Site", proj.live) : ""
  ].filter(Boolean).join("")

  const blocks = []

  ;(proj.sections || []).forEach(s => {
    blocks.push(`
      <section class="teaser">
        <div class="teaser-inner" style="--panel-bg:none;">
          <h2 style="margin:0 0 8px;">${s.heading}</h2>
          <p class="muted">${s.body}</p>
        </div>
      </section>
    `)
  })

  ;(proj.pdfs || []).forEach(p => {
    const pdfUrl = p.url || ""
    const src = `${viewer}?file=${encodeURIComponent(pdfUrl)}`
    blocks.push(`
      <section class="teaser">
        <div class="teaser-inner" style="--panel-bg:none;">
          <h2 style="margin:0 0 12px;">${p.label || "PDF"}</h2>
          <div class="player">
            <iframe src="${src}" loading="lazy" referrerpolicy="no-referrer"></iframe>
          </div>
          <div style="margin-top:12px;display:flex;justify-content:flex-end;">
            <a class="btn small" href="${p.open || p.url}" target="_blank" rel="noopener noreferrer">Open</a>
          </div>
        </div>
      </section>
    `)
  })

  ;(proj.youtube || []).forEach(v => {
    blocks.push(`
      <section class="teaser">
        <div class="teaser-inner" style="--panel-bg:none;">
          <h2 style="margin:0 0 12px;">${v.label || "Video"}</h2>
          <div class="player">
            <iframe
              src="https://www.youtube-nocookie.com/embed/${v.id}"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              loading="lazy"></iframe>
          </div>
          <div style="margin-top:12px;display:flex;justify-content:flex-end;">
            <a class="btn small" href="https://www.youtube.com/watch?v=${v.id}" target="_blank" rel="noopener noreferrer">Open on YouTube</a>
          </div>
        </div>
      </section>
    `)
  })

  sectionsEl.innerHTML = blocks.join("")
}
</script>

</body>
</html>
